@namespace FileFlows.Client.Pages
@page "/log"
@using FileFlows.Plugin

<div class="log-view">
    
    <div class="log html-log">
        <Virtualize Items="@FilteredLogEntries" Context="logLine" OverscanCount="10">
            <div>
                <pre class="language-log"><span class="log-date">@logLine.Date</span> [<span class="log-severity @(logLine.Severity.ToString().ToLowerInvariant())">@logLine.SeverityText</span>] <span class="log-message">@logLine.Message</span></pre>
            </div>
        </Virtualize>
    </div>

    <div class="side-search">
        <div class="title">
            <span class="icon fas fa-file-alt"></span>
            Log
        </div>
        <div class="search-fields">
            <div class="search-field input">
                <div class="label">Source</div>
                <div class="value">
                    <select @onchange="HandleSelection">
                        @foreach (var key in LoggingSources.Keys)
                        {
                            <optgroup label="@key">
                                @foreach (var file in LoggingSources[key])
                                {
                                    <option selected="@(file.FileName == ActiveFile?.FileName == true? "selected " : null)" value="@file.FileName">@file.ShortName</option>
                                }
                            </optgroup>
                        }
                    </select>
                </div>
            </div>
            <div class="search-field input">
                <div class="label">Severity</div>
                <div class="value">
                    <select @bind="SearchModel.Type">
                        <option value=@LogType.Error>Error</option>
                        <option value=@LogType.Warning>Warning</option>
                        <option value=@LogType.Info>Info</option>
                        <option value=@LogType.Debug>Debug</option>
                    </select>
                </div>
            </div>
            <div class="search-field input">
                <div class="label">
                    <FlowSwitch @bind-Value=@SearchModel.TypeIncludeHigherSeverity/>
                    Include Higher Severity
                </div>
            </div>
            <div class="search-field input">
                <div class="label">Text</div>
                <div class="value">
                    <input type="text" @bind="SearchModel.Message">
                </div>
            </div>
        </div>

        <button @onclick="Search">@lblSearch</button>
        <button @onclick="DownloadLog">@lblDownload</button>
    </div>
</div>